# **10\. Performance Requirements**

### **10.1 Performance Targets**

| Metric | Target | Acceptable |
| :---- | :---- | :---- |
| Time to First Byte (TTFB) | \< 200ms | \< 500ms |
| First Contentful Paint (FCP) | \< 1.0s | \< 2.0s |
| Largest Contentful Paint (LCP) | \< 2.0s | \< 3.0s |
| Cumulative Layout Shift (CLS) | \< 0.1 | \< 0.25 |
| First Input Delay (FID) | \< 50ms | \< 100ms |
| Total Blocking Time (TBT) | \< 200ms | \< 500ms |
| Staff availability check | \< 200ms | \< 500ms |
| Calendar render (30 days) | \< 1s | \< 2s |

### **10.2 Optimization Strategies**

#### **Frontend Optimization**

// Code splitting (automatic with Next.js App Router)  
const Calendar \= dynamic(() \=\> import('@/components/Calendar'), {  
  loading: () \=\> \<CalendarSkeleton /\>,  
  ssr: false  // Client-side only for heavy components  
});

const StaffSchedule \= dynamic(() \=\> import('@/components/StaffSchedule'), {  
  loading: () \=\> \<ScheduleSkeleton /\>,  
  ssr: false  
});

// Image optimization  
import Image from 'next/image';  
\<Image  
  src={staff.photoURL}  
  alt={staff.name}  
  width={100}  
  height={100}  
  priority={false}  // Lazy load staff photos  
/\>

// Font optimization  
import { Raleway, Poppins } from 'next/font/google';  
const raleway \= Raleway({   
  subsets: \['latin', 'thai'\],  
  display: 'swap'  
});

#### **Data Fetching Optimization**

// Server Components (default in App Router)  
async function BookingsList() {  
  const bookings \= await getBookings();  // Runs on server  
  return \<BookingTable bookings={bookings} /\>;  
}

// Streaming with Suspense  
\<Suspense fallback={\<BookingsSkeleton /\>}\>  
  \<BookingsList /\>  
\</Suspense\>

// Pagination & Lazy Loading  
const ITEMS\_PER\_PAGE \= 20;  
const { data, fetchNextPage } \= useInfiniteQuery({  
  queryKey: \['bookings'\],  
  queryFn: ({ pageParam \= 0 }) \=\> fetchBookings(pageParam),  
  getNextPageParam: (lastPage) \=\> lastPage.nextCursor  
});

// NEW: Staff data caching  
const { data: staff } \= useQuery({  
  queryKey: \['staff', 'active'\],  
  queryFn: fetchActiveStaff,  
  staleTime: 5 \* 60 \* 1000,    // 5 minutes  
  cacheTime: 30 \* 60 \* 1000    // 30 minutes  
});

#### **Firestore Query Optimization**

// Use composite indexes for common queries  
const q \= query(  
  collection(db, 'bookings'),  
  where('status', '==', 'confirmed'),  
  where('schedule.date', '\>=', startDate),  
  orderBy('schedule.date'),  
  limit(20)  
);

// NEW: Optimize staff availability checks  
const availabilityQuery \= query(  
  collection(db, 'schedules'),  
  where('date', '==', targetDate),  
  where('isFullyBooked', '==', false)  
);

// Cache frequently accessed data  
const cachedStaff \= useMemo(() \=\>   
  staff.reduce((acc, s) \=\> {  
    acc\[s.id\] \= s;  
    return acc;  
  }, {}),  
  \[staff\]  
);

// NEW: Denormalize for quick lookups  
// Store staff name/photo in booking document to avoid extra reads  
interface Booking {  
  // ...  
  assignedTo: {  
    id: string;  
    name: string;      // Denormalized  
    photoURL: string;  // Denormalized  
  };  
}

### **10.3 Monitoring & Alerting**

// Performance monitoring with Firebase Performance  
import { getPerformance, trace } from 'firebase/performance';

const perf \= getPerformance(app);

// Custom traces  
const bookingTrace \= trace(perf, 'booking\_creation');  
bookingTrace.start();  
// ... booking logic  
bookingTrace.stop();

// NEW: Staff-specific traces  
const staffAssignmentTrace \= trace(perf, 'staff\_assignment');  
const availabilityCheckTrace \= trace(perf, 'availability\_check');

// Set up alerts  
const alerts \= {  
  p95ResponseTime: {  
    threshold: 3000,  // ms  
    action: 'notify\_team'  
  },  
  errorRate: {  
    threshold: 0.05,  // 5%  
    action: 'page\_oncall'  
  },  
  staffAvailabilityCheckSlow: {  // NEW  
    threshold: 500,   // ms  
    action: 'investigate'  
  }  
};  
