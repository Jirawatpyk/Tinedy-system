# **5\. System Architecture**

### **5.1 Architecture Overview**

┌─────────────────────────────────────────────────────────┐  
│                     Client Layer                        │  
│  ┌────────────────────────────────────────────────┐   │  
│  │   Next.js 14 App (React 18 \+ TypeScript)       │   │  
│  │   \- Admin Dashboard                             │   │  
│  │   \- Staff Portal (NEW)                         │   │  
│  │   \- Server Components (SSR)                     │   │  
│  │   \- Client Components (Interactive)             │   │  
│  │   \- shadcn/ui \+ Tailwind CSS                   │   │  
│  └────────────────────────────────────────────────┘   │  
└─────────────────────────────────────────────────────────┘  
                          ↓ HTTPS  
┌─────────────────────────────────────────────────────────┐  
│                   API/Backend Layer                     │  
│  ┌────────────────────────────────────────────────┐   │  
│  │   Next.js API Routes                            │   │  
│  │   \- /api/bookings/\* │   │  
│  │   \- /api/customers/\* │   │  
│  │   \- /api/staff/\* (NEW)               │   │  
│  │   \- /api/assignments/\* (NEW)               │   │  
│  │   \- /api/schedules/\* (NEW)               │   │  
│  │   \- /api/webhooks/n8n                          │   │  
│  └────────────────────────────────────────────────┘   │  
└─────────────────────────────────────────────────────────┘  
                          ↓  
┌─────────────────────────────────────────────────────────┐  
│              Data & Services Layer                      │  
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  
│  │  Firebase   │  │  Firebase   │  │   N8N       │   │  
│  │  Firestore  │  │    Auth     │  │  Workflow   │   │  
│  │  (Database) │  │             │  │  Engine     │   │  
│  │  \- bookings │  │             │  │             │   │  
│  │  \- customers│  │             │  │             │   │  
│  │  \- staff    │  │             │  │             │   │  
│  │  \- teams    │  │             │  │             │   │  
│  └─────────────┘  └─────────────┘  └─────────────┘   │  
└─────────────────────────────────────────────────────────┘  
                          ↓  
┌─────────────────────────────────────────────────────────┐  
│             External Integrations                       │  
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  
│  │   Line OA   │  │   Email     │  │   SMS       │   │  
│  │   API       │  │  (SendGrid) │  │  Gateway    │   │  
│  └─────────────┘  └─────────────┘  └─────────────┘   │  
└─────────────────────────────────────────────────────────┘

### **5.2 Technology Stack**

#### **Frontend**

* **Framework:** Next.js 14 (App Router)  
* **Language:** TypeScript 5.3+  
* **UI Library:** React 18  
* **Component Library:** shadcn/ui (Radix UI primitives)  
* **Styling:** Tailwind CSS 3.4+  
* **State Management:** React Context \+ Zustand (for complex state)  
* **Forms:** React Hook Form \+ Zod validation  
* **Date/Time:** date-fns  
* **Icons:** Lucide React  
* **Calendar:** react-big-calendar (NEW)

#### **Backend**

* **Runtime:** Node.js 20 LTS  
* **API:** Next.js API Routes  
* **Authentication:** Firebase Auth  
* **Database:** Cloud Firestore  
* **Storage:** Firebase Storage (for staff photos, documents)

#### **DevOps & Infrastructure**

* **Hosting:** Firebase Hosting  
* **Functions:** Firebase Cloud Functions (when needed)  
* **CI/CD:** GitHub Actions  
* **Monitoring:** Firebase Analytics \+ Crashlytics  
* **Logging:** Cloud Logging

#### **Integration & Automation**

* **Workflow Engine:** N8N (self-hosted or cloud)  
* **Email:** SendGrid / Resend  
* **SMS:** Twilio / SMS API  
* **Line:** Line Messaging API  
* **Calendar Sync:** Google Calendar API (optional)

### **5.3 Deployment Architecture**

Production Environment:  
┌─────────────────────────────────────────┐  
│  Firebase Hosting (Global CDN)          │  
│  \- Static assets cached at edge         │  
│  \- SSL/TLS termination                  │  
└─────────────────────────────────────────┘  
              ↓  
┌─────────────────────────────────────────┐  
│  Cloud Run (Next.js SSR)                │  
│  \- Auto-scaling: 0-10 instances         │  
│  \- Region: asia-southeast1 (Singapore)  │  
└─────────────────────────────────────────┘  
              ↓  
┌─────────────────────────────────────────┐  
│  Cloud Firestore                        │  
│  \- Multi-region: asia-southeast1        │  
│  \- Automatic backup (daily)             │  
└─────────────────────────────────────────┘  
